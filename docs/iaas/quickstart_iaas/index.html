<!doctype html><html lang=fr dir=ltr class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-iaas/quickstart_iaas" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.6.1"><title data-rh=true>Automatisation avec Terraform | Documentation Cloud Temple</title><meta data-rh=true name=viewport content="width=device-width,initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:image content=https://github.com/docs-content/img/docusaurus-social-card.jpg><meta data-rh=true name=twitter:image content=https://github.com/docs-content/img/docusaurus-social-card.jpg><meta data-rh=true property=og:url content=https://github.com/docs-content/docs/iaas/quickstart_iaas/><meta data-rh=true property=og:locale content=fr><meta data-rh=true property=og:locale:alternate content=en><meta data-rh=true name=docusaurus_locale content=fr><meta data-rh=true name=docsearch:language content=fr><meta data-rh=true name=docusaurus_version content=current><meta data-rh=true name=docusaurus_tag content=docs-default-current><meta data-rh=true name=docsearch:version content=current><meta data-rh=true name=docsearch:docusaurus_tag content=docs-default-current><meta data-rh=true property=og:title content="Automatisation avec Terraform | Documentation Cloud Temple"><meta data-rh=true name=description content="Ce guide va vous permettre de déployer en moins de 5 minutes vos premières instances sur le Cloud de Confiance."><meta data-rh=true property=og:description content="Ce guide va vous permettre de déployer en moins de 5 minutes vos premières instances sur le Cloud de Confiance."><link data-rh=true rel=icon href=/docs-content/img/favicon.ico><link data-rh=true rel=canonical href=https://github.com/docs-content/docs/iaas/quickstart_iaas/><link data-rh=true rel=alternate href=https://github.com/docs-content/en/docs/iaas/quickstart_iaas/ hreflang=en><link data-rh=true rel=alternate href=https://github.com/docs-content/docs/iaas/quickstart_iaas/ hreflang=fr><link data-rh=true rel=alternate href=https://github.com/docs-content/docs/iaas/quickstart_iaas/ hreflang=x-default><link rel=stylesheet href=/docs-content/assets/css/styles.180585a3.css><script src=/docs-content/assets/js/runtime~main.c59cf96a.js defer></script><script src=/docs-content/assets/js/main.acb6ad39.js defer></script><body class=navigation-with-keyboard><script>!function(){var t,e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t=null!==e?e:"light",document.documentElement.setAttribute("data-theme",t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><div role=region aria-label="Aller au contenu principal"><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>Aller au contenu principal</a></div><nav aria-label=Main class="navbar navbar--fixed-top"><div class=navbar__inner><div class=navbar__items><button aria-label="Ouvrir/fermer la barre de navigation" aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/docs-content/><div class=navbar__logo><img src=/docs-content/img/logo.svg alt="Cloud Temple Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src=/docs-content/img/logo.svg alt="Cloud Temple Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate"></b></a><a aria-current=page class="navbar__item navbar__link navbar__link--active" href=/docs-content/docs/home/>Docs</a></div><div class="navbar__items navbar__items--right"><a href=https://github.com/cloud-temple target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href=# aria-haspopup=true aria-expanded=false role=button class=navbar__link><svg viewBox="0 0 24 24" width=20 height=20 aria-hidden=true class=iconLanguage_nlXk><path fill=currentColor d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"/></svg>Français</a><ul class=dropdown__menu><li><a href=/docs-content/en/docs/iaas/quickstart_iaas/ rel="noopener noreferrer" class=dropdown__link lang=en>English</a><li><a href=/docs-content/docs/iaas/quickstart_iaas/ rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang=fr>Français</a></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-label="Basculer entre le mode sombre et clair (actuellement mode clair)" aria-live=polite aria-pressed=false><svg viewBox="0 0 24 24" width=24 height=24 class=lightToggleIcon_pyhR><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 class=darkToggleIcon_wfgR><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg></button></div><div class=navbarSearchContainer_Bca1></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="main-wrapper mainWrapper_z2l0"><div class=docsWrapper_hBAB><button aria-label="Retour au début de la page" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type=button></button><div class=docRoot_UBD9><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class=sidebarViewport_aRkj><div class=sidebar_njMd><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-content/docs/home/>Bienvenue sur l'espace documentation Cloud Temple.</a><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs-content/docs/category/console/>Console</a><button aria-label="Développer la catégorie 'Console' de la barre latérale" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs-content/docs/category/getting-started/>Getting Started</a><button aria-label="Réduire la catégorie 'Getting Started' de la barre latérale" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/getting_started/changes/>Suivi des changements</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs-content/docs/category/bastion/>Bastion</a><button aria-label="Développer la catégorie 'Bastion' de la barre latérale" aria-expanded=false type=button class="clean-btn menu__caret"></button></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--active" href=/docs-content/docs/category/iaas/>IaaS</a><button aria-label="Réduire la catégorie 'IaaS' de la barre latérale" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/iaas/>Présentation</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/concepts/>Concepts</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/backup/>Sauvegarde</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/compute/>Calcul</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/metrics/>Metrologie IaaS</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/network/>Réseaux</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current=page tabindex=0 href=/docs-content/docs/iaas/quickstart_iaas/>Automatisation avec Terraform</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/quickstart_iaas_template/>Déploiement depuis un template</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/storage/>Stockage</a><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/iaas/tutorials_iaas/>Comment faire pour ?</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist" href=/docs-content/docs/category/housing/>Housing</a><button aria-label="Réduire la catégorie 'Housing' de la barre latérale" aria-expanded=true type=button class="clean-btn menu__caret"></button></div><ul style=display:block;overflow:visible;height:auto class=menu__list><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class=menu__link tabindex=0 href=/docs-content/docs/housing/>Hébergement physique</a></ul><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs-content/docs/contract/cgvu/>contract</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs-content/docs/faq/bastion/bastion_faq/>faq</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs-content/docs/network/install_guides/fortinet/forti/>network</a></div><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class=menu__list-item-collapsible><a class="menu__link menu__link--sublist menu__link--sublist-caret" role=button aria-expanded=false href=/docs-content/docs/paas/concepts/>paas</a></div><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class=menu__link href=/docs-content/docs/privacy/>privacy</a></ul></nav></div></div></aside><main class=docMainContainer_TBSr><div class="container padding-top--md padding-bottom--lg"><div class=row><div class="col docItemCol_VOVn"><div class=docItemContainer_Djhp><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Fil d'Ariane"><ul class=breadcrumbs itemscope itemtype=https://schema.org/BreadcrumbList><li class=breadcrumbs__item><a aria-label="Page d'accueil" class=breadcrumbs__link href=/docs-content/><svg viewBox="0 0 24 24" class=breadcrumbHomeIcon_YNFT><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill=currentColor /></svg></a><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class=breadcrumbs__item><a class=breadcrumbs__link itemprop=item href=/docs-content/docs/category/iaas/><span itemprop=name>IaaS</span></a><meta itemprop=position content=1><li itemscope itemprop=itemListElement itemtype=https://schema.org/ListItem class="breadcrumbs__item breadcrumbs__item--active"><span class=breadcrumbs__link itemprop=name>Automatisation avec Terraform</span><meta itemprop=position content=2></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type=button class="clean-btn tocCollapsibleButton_TO0P">Sur cette page</button></div><div class="theme-doc-markdown markdown"><header><h1>Automatisation avec Terraform</h1></header><p>Ce guide va vous permettre de déployer en moins de 5 minutes vos premières instances sur le Cloud de Confiance.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=prérequis><strong>Prérequis</strong><a href=#prérequis class=hash-link aria-label="Lien direct vers prérequis" title="Lien direct vers prérequis">​</a></h2>
<ol>
<li>Avoir souscrit à l'offre Cloud Temple (souscription à l'offre IaaS).</li>
<li>Avoir les permissions activées pour le pilote des objets <strong>'IaaS'</strong></li>
</ol>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id=déployer-une-machine-virtuelle-via-terraform>Déployer une machine virtuelle via Terraform<a href=#déployer-une-machine-virtuelle-via-terraform class=hash-link aria-label="Lien direct vers Déployer une machine virtuelle via Terraform" title="Lien direct vers Déployer une machine virtuelle via Terraform">​</a></h2>
<p>Dans cette section, nous allons voir comment déployer en quelques minutes une machine virtuelle sur le Cloud de Confiance via le provider Terraform Cloud Temple.
Si vous n'avez pas encore utilisé le provider Cloud Temple, suivez les instructions qui figurent à l'adresse suivante pour l'installer et vous authentifier à votre tenant :</p>
<p><a href=https://registry.terraform.io/providers/Cloud-Temple/cloudtemple/latest/docs target=_blank rel="noopener noreferrer">https://registry.terraform.io/providers/Cloud-Temple/cloudtemple/latest/docs</a>.</p>
<p>On va commencer par créer un fichier .tf qui décrit l'instance que l'on souhaite déployer.
Le script suivant permet de déployer une machine virtuelle from scratch.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">    data "cloudtemple_compute_virtual_datacenter" "dc" {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      name = "DC-EQX6"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data "cloudtemple_compute_host_cluster" "flo" {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      name = "clu002-ucs01_FLO"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data "cloudtemple_compute_datastore_cluster" "koukou" {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      name = "sdrs001-LIVE_KOUKOU"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    resource "cloudtemple_compute_virtual_machine" "scratch" {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      name = "from-scratch"</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      memory                 = 8 * 1024 * 1024 * 1024</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      cpu                    = 2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      num_cores_per_socket   = 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      cpu_hot_add_enabled    = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      cpu_hot_remove_enabled = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      memory_hot_add_enabled = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      datacenter_id                = data.cloudtemple_compute_virtual_datacenter.dc.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      host_cluster_id              = data.cloudtemple_compute_host_cluster.flo.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      datastore_cluster_id         = data.cloudtemple_compute_datastore_cluster.koukou.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      guest_operating_system_moref = "amazonlinux2_64Guest"</span><br></span><span class=token-line style=color:#393A34><span class="token plain"> </span><br></span><span class=token-line style=color:#393A34><span class="token plain">      tags = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        created_by = "Terraform"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    }</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copier le code" title=Copier class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>Les paramètres utilisés dans ce script sont les suivants :</p>
<ul>
<li>datacenter_id (obligatoire) : datacenter dans lequel la machine virtuelle est déployée</li>
<li>host_cluster_id (obligatoire) : cluster dans lequel la machine virtuelle est déployée</li>
<li>name (obligatoire) : nom de la machine</li>
<li>memory : RAM allouée à la machine au départ</li>
<li>cpu : nombre de vCPU alloués à la machine au départ</li>
<li>num_cores_per_socket : nombre de cores par socket</li>
<li>datastore_cluster_id : datastore auquel la machine est rattachée</li>
<li>guest_operating_system_moref : système d'exploitation de la machine</li>
</ul>
<p>D'autres paramètres peuvent être appliqués à une machine virtuelle lors de son déploiement. Vous pouvez retrouver l'ensemble de ces paramètres à la page suivante de la documentation Terraform :</p>
<p><a href=https://registry.terraform.io/providers/Cloud-Temple/cloudtemple/latest/docs/resources/compute_virtual_machine target=_blank rel="noopener noreferrer">https://registry.terraform.io/providers/Cloud-Temple/cloudtemple/latest/docs/resources/compute_virtual_machine</a></p>
<p>Une fois le fichier .tf créé et sauvegardé, exécutez la commande suivante pour vérifier votre code :</p>
<p>terraform validate</p>
<p>Puis, planifiez le déploiement et vérifiez que le plan correspond à ce que vous souhaitez réaliser :</p>
<p>terraform plan</p>
<p>Enfin, déployez la machine virtuelle en exécutant la commande suivante :</p>
<p>terraform apply</p>
<p>##Utiliser cloud-init pour configurer une machine virtuelle déployée depuis le provider Terraform</p>
<p>L'outil <strong>'cloud-init'</strong> permet de personnaliser une machine virtuelle, ou une instance cloud, lors de son premier démarrage. Il s'agit d'un standard qui est très largement répandu.
Pour plus d'informations, se référer à la documentation : <a href=https://cloudinit.readthedocs.io/en/latest/ target=_blank rel="noopener noreferrer">https://cloudinit.readthedocs.io/en/latest/</a></p>
<p>###Compatibilité</p>
<p>Afin d’être en mesure de configurer via cloud-init une machine virtuelle déployée depuis le provider Terraform Cloud Temple, l’<strong>OVF</strong> utilisé pour déployer cette dernière doit être <strong>compatible</strong> avec <strong>cloud-init</strong>.</p>
<p>Pour vérifier la compatibilité de votre machine virtuelle avec cloud-init, entrez la commande suivante :</p>
<p><code>systemctl status cloud-init.service</code></p>
<p>Si cloud-init est correctement installé sur la machine, vous devriez constater une réponse comme ceci. (Voir capture d’écran ci-dessous)</p>
<p><img decoding=async loading=lazy alt=img src=/docs-content/assets/images/status_cloud_init-3725fa789e65b4643e836e8b92740a49.png width=2162 height=316 class=img_ev3q></p>
<p>Si besoin, vous pouvez trouver des images compatibles cloud-init sur internet (par exemple <a href=https://cloud-images.ubuntu.com/ target=_blank rel="noopener noreferrer">Ubuntu Cloud Image</a>) ou l’installer vous-même sur votre machine avant de la transformer en OVF.</p>
<p>###Déploiement</p>
<p>Maintenant que vous êtes certain que l’OVF déployé est bien compatible à cloud-init, voici un exemple de fichier terraform (.tf) que vous pouvez utiliser pour configurer votre machine virtuelle.
NB : Tous les exemples montrés ici peuvent être retrouvés dans le dossier exemples du repository du provider Terraform Cloud Temple ici : <a href=https://github.com/Cloud-Temple/terraform-provider-cloudtemple/tree/main/examples target=_blank rel="noopener noreferrer">https://github.com/Cloud-Temple/terraform-provider-cloudtemple/tree/main/examples</a></p>
<p>####<code>main.tf</code></p>
<div class="language-HCL language-hcl codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-hcl codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">resource "cloudtemple_compute_virtual_machine" "ubuntu-cloud-init" {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  name = "ubuntu-cloud-init"</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  memory                 = 8 * 1024 * 1024 * 1024</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  cpu                    = 2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  num_cores_per_socket   = 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  cpu_hot_add_enabled    = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  cpu_hot_remove_enabled = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  memory_hot_add_enabled = true</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  datacenter_id   = data.cloudtemple_compute_virtual_datacenter.TH3S.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  host_cluster_id = data.cloudtemple_compute_host_cluster.CLU001.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  datastore_id    = data.cloudtemple_compute_datastore.DS003.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  content_library_id      = data.cloudtemple_compute_content_library.local.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  content_library_item_id = data.cloudtemple_compute_content_library_item.ubuntu-cloudimg.id</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  power_state = "on"</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  backup_sla_policies = [</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data.cloudtemple_backup_sla_policy.sla001-daily-par7s.id,</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    data.cloudtemple_backup_sla_policy.sla001-weekly-par7s.id,</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ]</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  cloud_init = {</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    network-config = filebase64("./cloud-init/network-config.yml")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    user-data      = filebase64("./cloud-init/user-data.yml")</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  }</span><br></span><span class=token-line style=color:#393A34><span class="token plain">}</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copier le code" title=Copier class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>####<code>network-config.yml</code></p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>#cloud-config</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>network</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>version</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token key atrule" style=color:#00a4db>ethernets</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>eth0</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>dhcp4</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>addresses</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> 172.16.100.192/24</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>gateway4</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> 172.16.100.1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token key atrule" style=color:#00a4db>nameservers</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        </span><span class="token key atrule" style=color:#00a4db>addresses</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">          </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> 172.16.11.4</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copier le code" title=Copier class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>####<code>user-data.yml</code></p>
<div class="language-YAML language-yaml codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_biex><pre tabindex=0 class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>#cloud-config</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token key atrule" style=color:#00a4db>users</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> default</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>-</span><span class="token plain"> </span><span class="token key atrule" style=color:#00a4db>name</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> terraform</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>primary_group</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> users</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>shell</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> /bin/bash</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>sudo</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token string" style=color:#e3116c>'ALL=(ALL) NOPASSWD:ALL'</span><span class="token punctuation" style=color:#393A34>]</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>groups</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> sudo</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>lock_passwd</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean important" style=color:#36acaa>false</span><span class="token plain">  </span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token key atrule" style=color:#00a4db>plain_text_passwd</span><span class="token punctuation" style=color:#393A34>:</span><span class="token plain"> password</span><br></span></code></pre><div class=buttonGroup__atx><button type=button aria-label="Copier le code" title=Copier class=clean-btn><span class=copyButtonIcons_eSgA aria-hidden=true><svg viewBox="0 0 24 24" class=copyButtonIcon_y97N><path fill=currentColor d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"/></svg><svg viewBox="0 0 24 24" class=copyButtonSuccessIcon_LjdS><path fill=currentColor d=M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z /></svg></span></button></div></div></div>
<p>L’élement intéressant ici, est la présence de la propriété cloud-init, vous pouvez constater qu’elle est composé de deux sous-propriétés : <strong>network-config</strong>, et <strong>user-data</strong>.</p>
<p>Ces dernières font partie d’un ensemble de 7 propriétés que vous pouvez utiliser pour configurer votre machine virtuelle avec cloud-init.</p>
<ul>
<li><strong>user-data</strong> : Cette valeur doit être encodée en base64 et contient des notamment des informations de configuration pour les comptes utilisateurs de la machine virtuelle. Vous pouvez aussi y ajouter des scripts permettant d’installer ou mettre à jour des paquets.</li>
<li><strong>network-config</strong> : Cette valeur doit être encodée en base64 et contient notamment des informations de configuration réseau de la machine virtuelle.</li>
<li><strong>public-keys</strong> : Indique que l'instance doit remplir les 'authorized_keys' de l'utilisateur par défaut avec cette valeur.</li>
<li><strong>instance-id</strong> : Permet de définir un identifiant unique d’instance auprès de cloud-init.</li>
<li><strong>password</strong> : S'il est défini, le mot de passe de l'utilisateur par défaut sera défini à cette valeur pour permettre une connexion basée sur un mot de passe. Le mot de passe ne sera valable que pour une seule connexion. Si la valeur est 'RANDOM', un mot de passe aléatoire sera généré et affiché sur la console.</li>
<li><strong>hostname</strong> : Spécifie un nom d’hôte pour l’instance déployée.</li>
<li><strong>seedfrom</strong> : Permet de définir une URL sur laquelle cloud-init ira chercher les fichiers de configuration qu’il doit utiliser.
Pour plus d'information sur le fonctionnement de cloud-init, veuillez vous référer à la documentation officielle. <a href=https://cloudinit.readthedocs.io/en/latest/ target=_blank rel="noopener noreferrer">https://cloudinit.readthedocs.io/en/latest/</a></li>
</ul>
<p>###Execution</p>
<p>Pour vérifier la bonne exécution de cloud-init, vous devriez pouvoir vous connecter avec l’utilisateur que vous avez configuré dans le fichier user-data.yml ou le nom d’hôte changer pour être défini sur celui que vous avez mis dans ‘hostname’.</p>
<p>En cas de soucis, vous pouvez vérifier les logs de cloud-init en utilisant la commande suivante :</p>
<p><code>sudo cat /var/log/cloud-init-output.log</code></p>
<p>Vous devriez voir diverses informations sur l’execution de cloud-init. Sur la capture d’écran qui suit, on peut constater que la configuration du réseau s’est correctement passée.</p>
<p><img decoding=async loading=lazy src=/docs-content/assets/images/cloud-init-output-fc245b19698af055d522971ba83f0e6d.png width=2028 height=1480 class=img_ev3q></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class=col><a href=https://github.com/aelttil/docs-content/docs/iaas/quickstart_iaas.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>Éditer cette page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Pages de documentation"><a class="pagination-nav__link pagination-nav__link--prev" href=/docs-content/docs/iaas/network/><div class=pagination-nav__sublabel>Précédent</div><div class=pagination-nav__label>Réseaux</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/docs-content/docs/iaas/quickstart_iaas_template/><div class=pagination-nav__sublabel>Suivant</div><div class=pagination-nav__label>Déploiement depuis un template</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#prérequis class="table-of-contents__link toc-highlight"><strong>Prérequis</strong></a><li><a href=#déployer-une-machine-virtuelle-via-terraform class="table-of-contents__link toc-highlight">Déployer une machine virtuelle via Terraform</a></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class=footer__title>Docs</div><ul class="footer__items clean-list"><li class=footer__item><a class=footer__link-item href=/docs-content/docs/home/>Tutorial</a></ul></div><div class="col footer__col"><div class=footer__title>Community</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://www.linkedin.com/company/cloud-temple/ target=_blank rel="noopener noreferrer" class=footer__link-item>Linkedin<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a><li class=footer__item><a href=https://github.com/cloud-temple target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true viewBox="0 0 24 24" class=iconExternalLink_nPIU><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2024 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>